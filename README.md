# ALAN Standard Library v2.2.0

The Standard Library for [ALAN] Interactive Fiction Language.

Created by [Anssi Räisänen], released under [Artistic License 2.0].

Project maintained by [Anssi Räisänen] and [Tristano Ajmone].

> Required **Alan SDK**: [Alan v3.0 beta8][SDK] (or higher)

[SDK]: https://www.alanif.se/download-alan-v3/development-kits/development-kits-3-0beta8 "Go to the download page of this specific Alan SDK release"


-----

**Table of Contents**

<!-- MarkdownTOC autolink="true" bracket="round" autoanchor="false" lowercase="only_ascii" uri_encoding="true" levels="1,2,3" -->

- [Project Contents](#project-contents)
- [Downloading The Library](#downloading-the-library)
- [Building Instructions](#building-instructions)
- [System Requirements](#system-requirements)
    - [Alan SDK](#alan-sdk)
    - [Ruby](#ruby)
        - [Rake](#rake)
        - [Asciidoctor](#asciidoctor)
        - [Rouge](#rouge)
- [Project Settings](#project-settings)
    - [ALAN Sources and Scripts Encoding](#alan-sources-and-scripts-encoding)

<!-- /MarkdownTOC -->

-----

# Project Contents

The following table describes the repository structure:

|               path              | Git archive |             description              |
|---------------------------------|-------------|--------------------------------------|
| [`/_assets/`][_assets/]         | _excluded_  | toolchain assets                     |
| [`/_assets_src/`][_assets_src/] | _excluded_  | toolchain assets source files        |
| [`/lib_distro/`][lib_distro/]   |             | Standard Library distribution files  |
| [`/lib_source/`][lib_source/]   | _excluded_  | Standard Library development sources |
| [`/lib_tests/`][lib_tests/]     | _excluded_  | Standard Library test suite          |
| [`/tbd/`][tbd/]                 | _excluded_  | Unprocessed library assets           |

<!-- MarkdownTOC:excluded -->
## Source vs Distribution Folders

The [`/lib_source/`][lib_source/] and [`/lib_distro/`][lib_distro/] have symmetrical structures: the former contains the source files required to build some assets found in the latter, e.g. converting documents from AsciiDoc to HTML, or creating sanitized version of ALAN source files, etc.

In other words, [`/lib_source/`][lib_source/] is the developers' directory containing the source files, whereas [`/lib_distro/`][lib_distro/] contains the distribution version of library assets (i.e. the "final package").

Library assets which don't require building (e.g. the license file, and other ALAN sources) are stored directly in the [`/lib_distro/`][lib_distro/] folder and have no source counterpart in [`/lib_source/`][lib_source/].

End users are only interested in the contents of the [`/lib_distro/`][lib_distro/] folder.


<!-- MarkdownTOC:excluded -->
## Git Archive Exclusions

Only the contents of the [`/lib_distro/`][lib_distro/] folder will be exported in the generated Git archives for public distribution — i.e. the Zip files of public releases, or the archive generated by the **Download ZIP** menu in the repository homepage on GitHub.

The idea is to provide ALAN authors with a clean StdLib distribution, without the AsciiDoc sources, the test suite, repository configurations files, build scripts, etc. — just the material required to use the StdLib in their adventures.

Exclusion of files and folders from the generated Zip archives is controlled by the `export-ignore` rules defined inside the [`.gitattributes`][.gitattributes] file.


# Downloading The Library

If you're just interested in downloading the library you should head to the [releases page] and download the latest stable version distribution package, which will contain just the library assets without their development sources.

<!-- MarkdownTOC:excluded -->
## Downloading a Dev Snapshot

Alternatively, if you're interested in downloading the latest development snapshot of the library, you should:

1. Select the  `dev` branch from the repository branches drop-down menu.
2. Then click on the **Code** drop-down menu, then select **Download ZIP**.

The downloaded Zip file will contain only the package contents from the [`/lib_distro/`][lib_distro/] folder, without any of the development sources, just like the Zip files from the [releases page], except that these files will be from the development snapshot.

> **NOTE** — The `dev` branch always contains polished bug fixes and new features which have been thoroughly test, so it's safe to use a development snapshot of the library from that branch, although the documentation is not granted to be up-to-date.
> But being a development branch, there could be breaking changes between different development snapshots in the course of time.

<!-- separatore -->

> **WARNING** — Other dev branches (i.e. with a name other than `master` or `dev`) are usually temporary branches used to flesh out and test bug fixes and new features (e.g. `dev-clothing` or `dev-<some-feature>`), so they are not to be considered safe to use in production work.
> They should only be downloaded for testing purposes.


# Building Instructions

Building the entire project yourself, locally, is easier than it might seem; you'll only need to install Git, the Ruby (v3) language, a few Ruby gems (i.e. Ruby packages) and add the ALAN SDK binaries to your path (see [System Requirements](#system-requirements)).

Then, you'll just need to type `rake` in the terminal and the project will auto-magically build itself in front of your eyes.

<!-- MarkdownTOC:excluded -->
## Using Rake

The repository uses [Rake] to manage the toolchain.
Rake is a cross platform tool that ships with the Ruby language.

Rake will only build nonexistent or outdated files, tracking assets dependencies.

To build the entire repository, open a terminal (CMD, Bash, etc.) in any folder inside the repository directory tree and type:

    rake

That's all you really need to know to use Rake.
If you haven't used Rake before, here are some common tips:

To delete all generated files:

    rake clobber

To update only the documentation and its examples:

    rake docs

To update only the test suite:

    rake tests

To forcefully rebuild the whole toolchain, or a specific task, just add `-B` after the command, e.g.:

    rake -B
    rake tests -B
    rake doc -B

To list the main tasks available for this repository:

    rake -T

For other options, see `rake -h` and consult the official [Rake] documentation.


# System Requirements

In order to fully build this project you'll need the following tools:

- __[Alan SDK](#alan-sdk)__ (command line)
- __[Ruby 3](#ruby)__ — and the following Ruby gems:
    + __[Rake](#rake)__
    + __[Asciidoctor](#asciidoctor)__
    + __[Rouge](#rouge)__

## Alan SDK

To use the **Standard Library** in your adventures you'll need [Alan v3.0 beta8][SDK], or a later version.

To contribute to this repository you'll need the exact version of the command line [Alan SDK]  (Software Development Kit) indicated in the repository and make sure that both the Alan compiler and the ARun interpreter binaries are reachable through the system PATH.

> **NOTE** — We're working on an alternative solution that will delegate to Rake the task of downloading and updating the required SDK binaries (according to OS) and add them to a dedicated repository folder (ignore by Git) in order to make this project independent from any global SDK setup.
> In the meantime, you'll need to setup the SDK binaries manually.

## Ruby

You'll need Ruby version 3.

Windows users should use [RubyInstaller], which can also be installed as a [Chocolatey Ruby package] using the [Chocolatey GUI] package manager, which simplifies keeping it always up to date.

After having installed Ruby, you'll need to install the following Ruby gems (i.e. Ruby packages)...

> **NOTE** — Don't forget to keep your gems up-to-date via:
>
>     $ gem update

### Rake

Rake is now part of the official Ruby distribution, but in some Ruby versions (e.g. [Ruby for Windows]) Rake is included as a precompiled binary instead of a gem, so to ensure you're always using the latest Rake version you can install it as a gem via:

    $ gem install rake

Before installing it, Ruby will warn you that by installing Rake as a gem you'll be overriding the native Rake binary, just confirm and proceed — you can always roll back to using the native Rake binary by uninstalling the gem version, via:

    $ gem uninstall rake

Although overriding the default bundled Rake version with the latest Rake gem is not strictly necessary, it's strongly recommended in order to benefit from any fixes and new features.


### Asciidoctor

To install the __[Asciidoctor]__ gem:

    $ gem install asciidoctor

If Asciidoctor complaints about some missing gems (i.e. in error messages of failed build attempts), just install the gems indicated in the error messages.


### Rouge

You also need to install the [Rouge] gem, which is used for syntax highlighting the documentation.

    $ gem install rouge

# Project Settings

Info on how to correctly setup your working environment to work with this repository.

## ALAN Sources and Scripts Encoding

In order to work correctly with the ALAN sources in this repository, their solution and transcript files, the following file extensions need to be opened with the correct encoding in your editor:

|   ext.  |  encoding |                 file type                  |
|---------|-----------|--------------------------------------------|
| `.a3s`  | UTF-8 BOM | "solution" files (aka "commands scripts"). |
| `.a3t`  | UTF-8     | game transcripts.                          |
| `.alan` | UTF-8 BOM | ALAN source files.                         |
| `.i`    | UTF-8 BOM | ALAN included source files.                |


If your editor supports [EditorConfig] (either natively or via a third party plug-in), then it should automatically pick-up the project settings from our `.editoconfig` setting, so you won't need to do anything.
In all other cases, ensure that your editors handles the above extensions with the correct encoding.

The "`.a3s`" and "`.a3t`" file extensions are the new official extensions adopted by ARun for solution files and transcripts.
The `.a3` segment in their suffix provides an intuitive association with Alan&nbsp;3, and at the same time makes these extensions unique.
They were originally introduced to allow associating ALAN scripts to [ISO-8859-1] encoding without affecting common extensions like "`.log`" or "`.sol`", which are used in other contexts and associated to other encodings.

Now that ALAN supports UTF-8 encoded sources and scripts, we've opted to adopt UTF-8 with BOM for all ALAN sources, in order to ensure that editors will correctly auto-detect their encoding (e.g. in case the editor associates these extensions primarily with ISO-8859-1 encoding).
This means that you can still safely associate ALAN files to the ISO/Latin-1 encoding by default, in order to be able to work with old source adventures, yet also be able to autodetect UTF-8 encoded files thanks to the presence of a BOM (otherwise the editor has no way to determine the encoding when the files contain only ASCII characters).

As for generated transcripts, we use UTF-8 (without BOM) encoding, since ARun won't add a BOM, and also because these are always auto-generated and not intended for editing.

For more information on the introduction of the new "`.a3s`" and "`.a3t`" extension, see [alan-if/alan#2].

See also the [Sublime Alan IF documentation] on how these extensions are implemented in the [Alan package] for Sublime Text, which adds syntax support for them along with some useful features.


<!-----------------------------------------------------------------------------
                               REFERENCE LINKS
------------------------------------------------------------------------------>


[Artistic License 2.0]: ./lib_distro/StdLib/COPYING "View the full license file"

[ISO-8859-1]: https://en.wikipedia.org/wiki/ISO/IEC_8859-1 "Read Wikipedia's page on ISO-8859-1"

<!-- ALAN Links -->

[ALAN]: https://www.alanif.se/ "Visit ALAN website"
[Alan SDK]: https://www.alanif.se/download-alan-v3/development-kits "Go to the Alan SDK section of the Alan website"

<!-- 3rd party tools -->

[Asciidoctor]: https://github.com/asciidoctor/asciidoctor
[Chocolatey GUI]: https://community.chocolatey.org/packages/ChocolateyGUI
[Chocolatey Ruby package]: https://community.chocolatey.org/packages/ruby
[EditorConfig]: https://editorconfig.org "Visit EditorConfig website"
[Rake]: https://ruby.github.io/rake/ "Visit Rake website"
[Rouge]: https://github.com/rouge-ruby/rouge "Visit Rouge repository"
[Ruby for Windows]: https://rubyinstaller.org
[RubyInstaller]: https://rubyinstaller.org

<!-- Sublime-Alan -->

[Sublime Alan IF documentation]: https://github.com/tajmone/sublime-alan-if#transcipt-and-solution-syntaxes "Go to Sublime Alan IF documentation on Alan Solution and Transcript files"
[Alan package]: https://github.com/tajmone/sublime-alan-if "Go to the Sublime Alan IF project, a package that adds Alan syntax support to Sublime Text"

<!-- repo links -->

[releases page]: https://github.com/AnssiR66/AlanStdLib/releases "Jump to repository releases page"

<!-- project folders -->

[_assets/]: ./_assets/ "Navigate to repository assets folder"
[_assets_src/]: ./_assets_src/ "Navigate to repository assets source folder"
[lib_distro/]: ./lib_distro/ "Navigate to StdLib distribution folder"
[lib_source/]: ./lib_source/ "Navigate to StdLib sources folder"
[lib_tests/]: ./lib_tests/ "Navigate to test suite folder"
[tbd/]: ./tbd/ "Navigate to unprocessed library assets folder"

<!-- project files -->

[.gitattributes]: ./.gitattributes "View the contents of '.gitattributes'"

<!-- Issues -->

[alan-if/alan#2]: https://github.com/alan-if/alan/issues/2 "View Issue #2 at ALAN repository on GitHub"

<!-- people -->

[Anssi Räisänen]: https://github.com/AnssiR66 "View Anssi Räisänen's GitHub profile"
[Tristano Ajmone]: https://github.com/tajmone "View Tristano Ajmone's GitHub profile"

<!-- EOF -->
